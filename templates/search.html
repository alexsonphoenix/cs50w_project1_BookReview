{% extends "layout.html" %}

{% block title %}
    Search for books
{% endblock %}

{% block main %}
<form action="{{url_for('search')}}" method="post">
  <div class="form-inline">
    <div class="form-group">
      <select class="form-control" id="input_type" name="input_type">
        <option value="byIsbn">Search by ISBN</option>
        <option value="byTitle">Search by Title</option>
        <option value="byAuthor">Search by Author Name</option>
        <option value="byYear">Search by year</option>
      </select>
    </div>

    <div class="form-group">
      <label for="searchInput" class="sr-only">Type here</label>
      <input type="text" class="form-control" id="searchInput" name="searchInput" placeholder="ISBN, Title, Year or Author">
    </div>
    <button type="submit" class="btn btn-primary mb-2">Search</button>

    <div class="spinner-border text-info" role="status" id="searching" style="display:none;">
      <span class="sr-only">Loading...</span>
    </div>
    <div class="spinner-grow text-success" role="status" id="searched" style="display:none;">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</form>

<!-- Display results -->
<h2>Results:</h2>
<ul id="display_results"></ul>

<script type="text/javascript">
$(document).ready(function(){
  //var t;
  var user_input;

  $('input[name="searchInput"]').keyup(function(){
      var searching = document.getElementById("searching");
      var searched = document.getElementById("searched");
      searching.style.display = "inline";
      searched.style.display = "none";
      //t = document.getElementById("input_type");
      console.log("Key up function working");
      //var typeInput = t.options[t.selectedIndex].value;
      user_input = document.getElementById("searchInput").value;

      let html='';
      $.get('/search?q='+user_input)
            .done(function(data) {
                for (book of data){
                  html += '<li>' + book + '</li>';
                }
                console.log(html)
                document.getElementById('display_results').innerHTML = html;
                searching.style.display = "none";
                searched.style.display = "inline";
              });

  });
});
</script>
{% endblock %}
